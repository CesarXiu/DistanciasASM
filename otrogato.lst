     1                                 %line 1+1 otrogato.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 [section .data]
     7                                 
     8                                 
     9                                  EXIT_SUCCESS equ 0
    10                                  SYS_exit equ 60
    11                                 
    12                                  LF equ 10
    13                                  NULL equ 0
    14                                  TRUE equ 1
    15                                  FALSE equ 0
    16                                  STDIN equ 0
    17                                  STDOUT equ 1
    18                                  STDERR equ 2
    19                                  SYS_read equ 0
    20                                  SYS_write equ 1
    21                                  SYS_open equ 2
    22                                  SYS_close equ 3
    23                                  SYS_fork equ 57
    24                                  SYS_creat equ 85
    25                                  SYS_time equ 201
    26                                  O_CREAT equ 0x40
    27                                  O_TRUNC equ 0x200
    28                                  O_APPEND equ 0x400
    29                                  O_RONLY equ 000000
    30                                  O_WRONLY equ 000001
    31                                  O_RDWR equ 000002
    32                                  S_IRUSR equ 00400
    33                                  S_IWUSR equ 00200
    34                                  S_IXUSR equ 00100
    35                                 
    36                                 
    37 00000000 000000000000000000      matrix db 0,0,0,0,0,0,0,0,0
    38                                  BUFF_SIZE equ 255
    39 00000009 0A00                    newline db LF,NULL
    40 0000000B 0A50726F6772616D20-     header db LF,"Program to file READ example."
    41 0000000B 746F2066696C652052-
    42 0000000B 454144206578616D70-
    43 0000000B 6C652E             
    44 00000029 0A0A00                  db LF,LF,NULL
    45 0000002C 6D617472697A2E7478-     filename db "matriz.txt",NULL
    46 0000002C 7400               
    47 00000037 0000000000000000        fileDesc dq 0
    48 0000003F 4572726F72206F7065-     errMsgOpen db "Error opening file",LF,NULL
    49 0000003F 6E696E672066696C65-
    50 0000003F 0A00               
    51 00000053 4572726F7220726561-     errMSgWrite db "Error reading from file",LF,NULL
    52 00000053 64696E672066726F6D-
    53 00000053 2066696C650A00     
    54 0000006C 536920736520416272-     exito db "Si se Abrio el archivo",LF,LF,NULL
    55 0000006C 696F20656C20617263-
    56 0000006C 6869766F0A0A00     
    57 00000085 20456C20636F6E7465-     paso db " El contenido del archivo es: ",LF,LF,NULL
    58 00000085 6E69646F2064656C20-
    59 00000085 6172636869766F2065-
    60 00000085 733A200A0A00       
    61 000000A6 0A2043455252414E44-     closef db LF," CERRANDO EL ARCHIVO ",LF,LF,NULL
    62 000000A6 4F20454C2041524348-
    63 000000A6 49564F200A0A00     
    64                                 
    65                                 
    66                                 [section .bss]
    67 00000000 <gap>                   readBuffer resb BUFF_SIZE
    68                                 
    69                                 
    70                                 [section .text]
    71                                 [global _start]
    72                                  _start:
    73                                 
    74                                 
    75 00000000 48C7C7[00000000]        mov rdi, header
    76 00000007 E8D6000000              call printString
    77                                 
    78                                 
    79                                 
    80                                 
    81                                 
    82                                 
    83                                 
    84                                 
    85                                  openInputFile:
    86 0000000C 48C7C002000000          mov rax,SYS_open
    87 00000013 48C7C7[00000000]        mov rdi,filename
    88 0000001A 48C7C600000000          mov rsi, O_RONLY
    89 00000021 0F05                    syscall
    90 00000023 4883F800                cmp rax,0
    91 00000027 0F8C88000000            jl errorOpen
    92 0000002D 48890425[00000000]      mov qword[fileDesc],rax
    93 00000035 48C7C7[00000000]        mov rdi, exito
    94 0000003C E8A1000000              call printString
    95                                 
    96                                 
    97                                 
    98                                 
    99                                 
   100                                 
   101                                 
   102                                 
   103 00000041 48C7C000000000          mov rax, SYS_read
   104 00000048 488B3C25[00000000]      mov rdi, qword[fileDesc]
   105 00000050 48C7C6[00000000]        mov rsi, readBuffer
   106 00000057 48C7C2FF000000          mov rdx, BUFF_SIZE
   107 0000005E 0F05                    syscall
   108 00000060 4883F800                cmp rax,0
   109 00000064 7C61                    jl errorOnRead
   110                                 
   111                                 
   112 00000066 48C7C7[00000000]        mov rdi, paso
   113 0000006D E870000000              call printString
   114                                 
   115                                 
   116 00000072 48C7C6[00000000]        mov rsi,readBuffer
   117 00000079 C6040600                mov byte[rsi+rax], NULL
   118 0000007D 48C7C7[00000000]        mov rdi, readBuffer
   119 00000084 E859000000              call printString
   120                                 
   121 00000089 48C7C7[00000000]        mov rdi, readBuffer
   122 00000090 48C7C6[00000000]        mov rsi, matrix
   123                                  bpoint:
   124 00000097 E879000000              call procesarMatriz
   125                                  lstpoint:
   126                                 
   127                                 
   128 0000009C 48C7C7[00000000]        mov rdi, closef
   129 000000A3 E83A000000              call printString
   130                                 
   131                                 
   132 000000A8 48C7C003000000          mov rax, SYS_close
   133 000000AF 488B3C25[00000000]      mov rdi, qword[fileDesc]
   134 000000B7 0F05                    syscall
   135 000000B9 EB1A                    jmp last
   136                                  errorOpen:
   137 000000BB 48C7C7[00000000]        mov rdi, errMsgOpen
   138 000000C2 E81B000000              call printString
   139 000000C7 EB0C                    jmp last
   140                                  errorOnRead:
   141 000000C9 48C7C7[00000000]        mov rdi,errMSgWrite
   142 000000D0 E80D000000              call printString
   143 000000D5 EBFE                    jmp last
   144                                  last:
   145 000000D7 48C7C03C000000          mov rax, SYS_exit
   146 000000DE 48C7C700000000          mov rdi, EXIT_SUCCESS
   147 000000E5 0F05                    syscall
   148                                 
   149                                 
   150                                 
   151                                 
   152                                 [global printString]
   153                                 printString:
   154                                 
   155 000000E7 53                      push rbx
   156                                 
   157 000000E8 4889FB                  mov rbx, rdi
   158 000000EB 48C7C200000000          mov rdx, 0
   159                                  countStrLoop:
   160 000000F2 803B00                  cmp byte[rbx],NULL
   161 000000F5 7406                    je countStrDone
   162 000000F7 48FFC2                  inc rdx
   163 000000FA 48FFC3                  inc rbx
   164 000000FD EBF1                    jmp countStrLoop
   165                                  countStrDone:
   166 000000FF 4883FA00                cmp rdx,0
   167 00000103 7411                    je prtDone
   168                                 
   169                                 
   170 00000105 48C7C001000000          mov rax, SYS_write
   171 0000010C 4889FE                  mov rsi,rdi
   172 0000010F 48C7C701000000          mov rdi,STDOUT
   173                                 
   174 00000116 0F05                    syscall
   175                                 
   176                                 
   177                                  prtDone:
   178 00000118 5B                      pop rbx
   179 00000119 C3                      ret
   180                                 
   181                                 [global procesarMatriz]
   182                                 
   183                                 
   184                                  procesarMatriz:
   185 0000011A 53                      push rbx
   186 0000011B 4154                    push r12
   187                                 
   188 0000011D 48C7C109000000          mov rcx, 9
   189 00000124 48C7C200000000          mov rdx, 0
   190 0000012B 49C7C400000000          mov r12, 0
   191                                  mainLoop:
   192 00000132 8A0417                  mov al, byte[rdi+rdx]
   193 00000135 48FFC2                  inc rdx
   194 00000138 3C20                    cmp al, 0x20
   195 0000013A 74F4                    je mainLoop
   196 0000013C 2C30                    sub al, '0'
   197 0000013E 42880426                mov byte[rsi+r12], al
   198 00000142 49FFC4                  inc r12
   199 00000145 E2E9                    loop mainLoop
   200 00000147 5B                      pop rbx
   201 00000148 415C                    pop r12
   202 0000014A C3                      ret
